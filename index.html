<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Heavenlynn Menu</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Playfair+Display:wght@500;700&family=Poppins:wght@300;400;500;600&family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #722F37;
      --primary-light: #faf0f0;
      --primary-dark: #4a1c22;
      --accent: #d4a574;
      --background: #fdfbf9;
      --card-bg: #fff;
      --text: #3d2a2a;
      --text-light: #6b5252;
      --shadow-sm: 0 4px 12px rgba(114,47,55,.08);
      --shadow-md: 0 6px 16px rgba(114,47,55,.12);
      --shadow-lg: 0 12px 24px rgba(114,47,55,.16);
      --gradient: linear-gradient(135deg,#722F37,#d4a574);
      --transition: all .3s cubic-bezier(.25,.8,.25,1);
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 30px;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Poppins', sans-serif; background: var(--background); color: var(--text); line-height: 1.6; overflow-x: hidden; }
    h1, h2, h3 { font-family: 'Playfair Display', serif; }

    /* Snowflakes */
    .snowflakes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998; overflow: hidden; }
    .snowflake { position: absolute; top: -20px; color: #fff; font-size: 1rem; text-shadow: 0 0 5px rgba(255,255,255,.8); animation: fall linear infinite; opacity: 0.7; }
    .snowflake:nth-child(1) { left: 5%; animation-duration: 10s; animation-delay: 0s; font-size: 0.8rem; }
    .snowflake:nth-child(2) { left: 15%; animation-duration: 12s; animation-delay: 1s; font-size: 1.2rem; }
    .snowflake:nth-child(3) { left: 25%; animation-duration: 8s; animation-delay: 2s; font-size: 0.9rem; }
    .snowflake:nth-child(4) { left: 35%; animation-duration: 14s; animation-delay: 0.5s; font-size: 1rem; }
    .snowflake:nth-child(5) { left: 45%; animation-duration: 9s; animation-delay: 3s; font-size: 0.7rem; }
    .snowflake:nth-child(6) { left: 55%; animation-duration: 11s; animation-delay: 1.5s; font-size: 1.1rem; }
    .snowflake:nth-child(7) { left: 65%; animation-duration: 13s; animation-delay: 2.5s; font-size: 0.85rem; }
    .snowflake:nth-child(8) { left: 75%; animation-duration: 10s; animation-delay: 4s; font-size: 1rem; }
    .snowflake:nth-child(9) { left: 85%; animation-duration: 15s; animation-delay: 0s; font-size: 0.75rem; }
    .snowflake:nth-child(10) { left: 95%; animation-duration: 8s; animation-delay: 2s; font-size: 1.3rem; }
    @keyframes fall { 0% { top: -20px; transform: translateX(0) rotate(0deg); opacity: 0.7; } 50% { opacity: 1; } 100% { top: 100vh; transform: translateX(50px) rotate(360deg); opacity: 0.3; } }

    /* Loading Screen */
    .cookie-loading-screen {
      position: fixed; inset: 0; background: linear-gradient(135deg,#722F37,#2d4a3e);
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      z-index: 9999; transition: opacity .8s, visibility .8s;
    }
    .cookie-loading-screen.hide { opacity: 0; visibility: hidden; }
    .loading-text { font-family: 'Dancing Script', cursive; font-size: 2.5rem; color: #fff; text-shadow: 0 3px 6px rgba(0,0,0,.3); margin-bottom: 1rem; }
    .loading-subtitle { font-family: 'Poppins', sans-serif; font-size: 1.1rem; color: rgba(255,255,255,.9); margin-bottom: 2rem; }

    /* Cookie Jar - Santa Sleigh */
    .cookie-jar { display: flex; flex-direction: column; align-items: center; margin-top: 1rem; position: relative; }
    .jar { position: relative; width: 200px; height: 120px; animation: sleigh-float 3s ease-in-out infinite; }
    .jar-lid { width: 200px; height: 60px; background: transparent; border-radius: 0; position: absolute; top: 0; left: 0; border: none; box-shadow: none; z-index: 10; font-size: 3rem; text-align: center; line-height: 60px; }
    .jar-lid::after { content: 'ü¶åü¶åü¶å'; position: absolute; top: 10px; left: -60px; transform: none; font-size: 1.8rem; animation: reindeer-run 0.5s steps(2) infinite; }
    .jar-body { width: 200px; height: 80px; background: transparent; border-radius: 0; border: none; position: absolute; top: 40px; left: 20px; display: flex; flex-wrap: nowrap; justify-content: center; align-items: center; padding: 0; overflow: visible; box-shadow: none; }
    .cookie-in-jar { font-size: 1.5rem; margin: 2px; animation: cookie-float 2s ease-in-out infinite alternate; cursor: pointer; }
    .cookie-in-jar:nth-child(1) { animation-delay: 0s; position: absolute; top: -20px; left: 80px; }
    .cookie-in-jar:nth-child(2) { animation-delay: .3s; position: absolute; top: -15px; left: 100px; }
    .cookie-in-jar:nth-child(3) { animation-delay: .6s; position: absolute; top: -25px; left: 120px; }
    .cookie-in-jar:nth-child(4) { animation-delay: .9s; position: absolute; top: -10px; left: 140px; }
    .cookie-in-jar:nth-child(5) { animation-delay: 1.2s; position: absolute; top: -20px; left: 160px; }
    .cookie-in-jar.eaten { opacity: 0; transform: scale(0) rotate(720deg) translateY(-50px); animation: cookie-poof .8s ease-out forwards; }
    .loading-text-small { margin-top: 60px; font-size: 1rem; color: rgba(255,255,255,.9); font-style: italic; font-family: 'Dancing Script', cursive; }
    .cookie-jar::after { content: '‚ú®'; position: absolute; top: 30px; right: 20px; font-size: 1rem; color: #fff; animation: sparkle-dance 1s ease-in-out infinite; }
    .cookie-jar::before { content: '‚≠ê'; position: absolute; top: 20px; left: 30px; font-size: 0.8rem; color: #ffd700; animation: sparkle-dance 1.5s ease-in-out infinite reverse; }

    /* Contact Bar */
    .contact-bar { background: linear-gradient(90deg,#722F37,#8b4049); color: #faf0f0; padding: 14px 20px; box-shadow: 0 3px 12px rgba(0,0,0,.15); border-bottom: 2px solid #d4a574; z-index: 20; }
    .contact-info { display: flex; align-items: center; justify-content: center; gap: 15px; max-width: 1200px; margin: 0 auto; flex-wrap: wrap; }
    .contact-item { display: flex; align-items: center; gap: 10px; font-size: 1rem; padding: 0 12px; }
    .contact-item i { color: #d4a574; }
    .contact-item span { font-weight: 500; font-style: italic; text-transform: lowercase; }
    .contact-item a { display: flex; align-items: center; gap: 10px; color: #faf0f0; text-decoration: none; transition: var(--transition); }
    .contact-item a:hover { color: #d4a574; }
    .contact-separator { width: 1px; height: 24px; background: rgba(255,255,255,.4); }

    /* Hero */
    .hero { height: 65vh; max-height: 550px; min-height: 350px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; text-align: center; }
    .slideshow-container { position: absolute; inset: 0; z-index: -1; overflow: hidden; }
    .slide { position: absolute; opacity: 0; inset: 0; transition: opacity 1s ease-in-out; background-size: cover; background-position: center; z-index: -1; }
    .slide.active { opacity: 1; z-index: 0; }
    .hero-overlay { background: linear-gradient(0deg,rgba(61,42,42,.75),rgba(114,47,55,.5)); position: absolute; inset: 0; }
    .hero-content { position: relative; padding: 0 2rem; text-shadow: 0 2px 10px rgba(0,0,0,.4); }
    .hero-tagline { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.1rem,2.5vw,1.5rem); color: #fff; letter-spacing: 1px; margin-top: -.5rem; margin-bottom: 2rem; }
    .hero h1 { font-family: 'Dancing Script', cursive; font-size: clamp(3.5rem,10vw,6rem); font-weight: 700; color: #fff; margin-bottom: 1rem; }
    .slideshow-dots { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 5; }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,.5); cursor: pointer; transition: var(--transition); border: 2px solid transparent; }
    .dot.active { background: #d4a574; transform: scale(1.3); border-color: #fff; }
    .scroll-down { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); color: #fff; font-size: 2rem; animation: bounce 2s infinite; cursor: pointer; z-index: 1; }

    /* Navigation */
    .nav-wrapper { background: #fdfbf9; backdrop-filter: blur(8px); position: sticky; top: 0; z-index: 20; box-shadow: var(--shadow-sm); padding: 1rem .5rem; border-top: 3px solid #d4a574; border-bottom: 3px solid #2d4a3e; transition: var(--transition); }
    .nav-wrapper.scrolled { padding: .7rem .5rem; }
    nav.nav-container { display: flex; flex-wrap: nowrap; gap: .5rem; max-width: 1200px; margin: auto; overflow-x: auto; padding: 10px 5px; scroll-snap-type: x mandatory; scroll-behavior: smooth; scrollbar-width: none; }
    nav.nav-container::-webkit-scrollbar { display: none; }
    nav a { text-decoration: none; color: var(--primary-dark); font-weight: 500; padding: .6rem .7rem; border-radius: var(--radius-sm); background: var(--primary-light); border: 1px solid var(--primary); display: flex; align-items: center; gap: 6px; font-size: .85rem; box-shadow: var(--shadow-md); transition: var(--transition); white-space: nowrap; scroll-snap-align: start; }
    nav a:hover, nav a.active { background: var(--gradient); color: #fff; transform: translateY(-3px); }

    /* Featured Section */
    .featured-section { padding: 2rem 1rem; margin: 0 auto 1rem; max-width: 1200px; }
    .featured-header { display: flex; align-items: center; justify-content: center; margin-bottom: 2rem; position: relative; margin-top: 2rem; }
    .featured-header h2 { font-size: 2rem; color: var(--primary-dark); padding: 0 1.5rem; }
    .featured-header::before, .featured-header::after { content: ""; height: 2px; background: linear-gradient(90deg,#2d4a3e,#d4a574); flex-grow: 1; border-radius: 2px; }
    .featured-badge { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); background: #2d4a3e; color: #fff; padding: 4px 15px; border-radius: 20px; font-size: .8rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }
    .featured-slider { overflow-x: auto; scroll-behavior: smooth; display: flex; gap: 20px; padding: .5rem .5rem 1.5rem; scrollbar-width: none; }
    .featured-slider::-webkit-scrollbar { display: none; }
    .featured-item { min-width: 250px; width: 250px; flex: 0 0 auto; border-radius: var(--radius-md); overflow: visible; box-shadow: var(--shadow-md); transition: var(--transition); background: #fff; border: 2px solid var(--primary-light); position: relative; }
    .featured-item:hover { transform: translateY(-8px); box-shadow: var(--shadow-lg); border-color: #d4a574; }
    .featured-img { height: 160px; overflow: hidden; border-radius: var(--radius-md) var(--radius-md) 0 0; }
    .featured-img img { width: 100%; height: 100%; object-fit: cover; transition: transform .5s; filter: saturate(1.2); }
    .featured-item:hover .featured-img img { transform: scale(1.1); }
    .featured-content { padding: 1rem; text-align: center; }
    .featured-name { font-weight: 600; font-size: 1.2rem; color: var(--primary-dark); margin-bottom: .5rem; }
    .featured-desc { font-size: .9rem; color: var(--text-light); margin-bottom: 1rem; line-height: 1.4; }
    .featured-footer { display: flex; justify-content: space-between; align-items: center; padding-top: .5rem; border-top: 1px dashed #2d4a3e; }
    .featured-price { font-weight: bold; color: var(--primary); font-size: 1.1rem; }
    .featured-button { background: var(--primary-light); color: var(--primary-dark); border: none; padding: .4rem .8rem; font-size: .8rem; border-radius: 20px; font-weight: 500; cursor: pointer; transition: var(--transition); }
    .featured-button:hover { background: var(--primary); color: #fff; }
    .limited-tag { position: absolute; top: 10px; right: 10px; background: #2d4a3e; color: #fff; padding: 3px 10px; border-radius: 10px; font-size: .7rem; font-weight: 500; transform: rotate(5deg); box-shadow: 0 2px 4px rgba(0,0,0,.2); }
    .slider-controls { display: flex; justify-content: center; gap: 15px; margin-top: 1rem; }
    .slider-btn { width: 40px; height: 40px; border-radius: 50%; background: #fff; border: 2px solid var(--primary); color: var(--primary-dark); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); }
    .slider-btn:hover { background: var(--primary); color: #fff; transform: scale(1.1); }

    /* Main Content */
    main { padding: 2rem 1rem; max-width: 1200px; margin: 0 auto; }
    section { margin-bottom: 4rem; scroll-margin-top: 100px; }
    .section-title { display: flex; align-items: center; margin-bottom: 2rem; }
    .section-title::after { content: ""; flex-grow: 1; height: 2px; background: linear-gradient(90deg,#722F37,#d4a574); margin-left: 15px; }
    .section-title h2 { font-size: 2rem; color: #722F37; }

    /* Menu Items */
    .items-grid { display: flex; flex-direction: column; }
    .item-card { background: rgba(255,255,255,.95); display: grid; grid-template-columns: 120px 1fr; align-items: center; padding: 1.5rem 0; border-bottom: 1px solid #faf0f0; position: relative; }
    .item-card:first-child { border-top: 1px solid #faf0f0; }
    .item-card:hover { background: rgba(250,240,240,.15); }
    .item-image { width: 90px; height: 90px; border-radius: 50%; overflow: hidden; box-shadow: var(--shadow-sm); }
    .item-card img { width: 100%; height: 100%; object-fit: cover; transition: transform .5s; filter: saturate(1.2) contrast(1.1); }
    .item-card:hover img { transform: scale(1.05); }
    .item-content { padding: 0 1rem; }
    .item-name { font-size: 1.2rem; font-weight: 600; color: var(--primary-dark); margin-bottom: .3rem; }
    .item-desc { font-size: .9rem; color: var(--text-light); margin-bottom: .8rem; line-height: 1.4; }
    .item-footer { display: flex; justify-content: space-between; align-items: center; }
    .item-price { font-size: 1.1rem; font-weight: bold; color: #722F37; }
    .badge { position: absolute; top: 1.5rem; right: -10px; background: #d4a574; color: #fff; padding: 3px 8px; border-radius: 12px; font-size: .7rem; font-weight: 500; }
    .preorder-tag { position: absolute; top: 10px; left: 10px; background: linear-gradient(135deg,#722F37,#d4a574); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: .8rem; font-weight: 600; transform: rotate(-5deg); box-shadow: 0 3px 8px rgba(114,47,55,.3); border: 1px solid #fff; animation: gentle-float 3s infinite alternate; }
    .add-to-cart-btn { background: var(--primary); color: #fff; border: none; padding: .5rem 1rem; border-radius: var(--radius-sm); font-size: .9rem; font-weight: 500; cursor: pointer; transition: var(--transition); }
    .add-to-cart-btn:hover { background: var(--primary-dark); transform: translateY(-2px); }

    /* Transparent images for specific sections */
    section#cookies .item-image, section#rolls .item-image, section#slices .item-image, section#cakes .item-image,
    section#cookie-cakes .item-image, section#cups .item-image, section#cheesecakes .item-image,
    section#ice-cream .item-image, section#drinks .item-image {
      background: none !important; border: none !important; box-shadow: none !important; border-radius: 0 !important;
    }
    section#cookies .item-image img, section#rolls .item-image img, section#slices .item-image img, section#cakes .item-image img,
    section#cookie-cakes .item-image img, section#cups .item-image img, section#cheesecakes .item-image img,
    section#ice-cream .item-image img, section#drinks .item-image img {
      background: none !important; border-radius: 0 !important; object-fit: contain !important; filter: none !important;
    }

    /* Shopping Cart */
    .cart-btn { position: fixed; right: 20px; bottom: 150px; width: 60px; height: 60px; background: #d4a574; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: var(--shadow-md); cursor: pointer; z-index: 20; transition: var(--transition); border: none; }
    .cart-btn:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
    .cart-count { position: absolute; top: -5px; right: -5px; background: #722F37; color: #fff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: .8rem; font-weight: bold; border: 2px solid #fff; }
    .cart-modal { position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 1000; display: none; overflow-y: auto; }
    .cart-content { background: #fff; margin: 20px auto; padding: 2rem; border-radius: var(--radius-md); max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
    .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 2px solid var(--primary-light); padding-bottom: 1rem; }
    .cart-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--primary-light); }
    .cart-item-info { flex: 1; }
    .cart-item-name { font-weight: 600; color: var(--primary-dark); }
    .cart-item-price { color: var(--text-light); font-size: .9rem; }
    .cart-item-controls { display: flex; align-items: center; gap: 1rem; }
    .quantity-controls { display: flex; align-items: center; gap: .5rem; }
    .qty-btn { width: 30px; height: 30px; border: 1px solid var(--primary); background: #fff; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; }
    .qty-btn:hover { background: var(--primary); color: #fff; }
    .remove-item { background: #722F37; color: #fff; border: none; padding: .3rem .6rem; border-radius: var(--radius-sm); cursor: pointer; font-size: .8rem; }
    .cart-total { text-align: center; margin: 1.5rem 0; padding: 1rem; background: var(--primary-light); border-radius: var(--radius-sm); }
    .cart-total-amount { font-size: 1.5rem; font-weight: bold; color: var(--primary-dark); }
    .order-btn { width: 100%; background: var(--primary); color: #fff; border: none; padding: 1rem; border-radius: var(--radius-sm); font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: var(--transition); }
    .order-btn:hover { background: var(--primary-dark); }
    .order-btn:disabled { background: var(--text-light); cursor: not-allowed; }
    .empty-cart { text-align: center; padding: 2rem; color: var(--text-light); }

    /* Thank You Modal */
    .thank-you-modal { position: fixed; inset: 0; background: rgba(0,0,0,.8); z-index: 2000; display: none; justify-content: center; align-items: center; }
    .thank-you-content { background: #fff; padding: 3rem; border-radius: var(--radius-lg); text-align: center; max-width: 400px; animation: bounce-in .6s ease-out; }
    .thank-you-cookie { font-size: 4rem; margin-bottom: 1rem; animation: cookie-spin 2s ease-in-out infinite; }

    /* Category Scroll Button */
    .category-scroll-btn { position: fixed; right: 20px; bottom: 80px; width: 50px; height: 50px; background: #2d4a3e; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: var(--shadow-md); cursor: pointer; z-index: 20; transition: var(--transition); border: none; }
    .category-scroll-btn:hover { background: #1e332b; transform: translateY(-5px) rotate(-15deg); }
    .category-dropdown { position: fixed; right: 20px; bottom: 140px; background: #fff; border-radius: var(--radius-md); box-shadow: var(--shadow-lg); padding: 1rem; z-index: 20; min-width: 200px; opacity: 0; visibility: hidden; transform: translateY(20px); transition: var(--transition); }
    .category-dropdown.show { opacity: 1; visibility: visible; transform: translateY(0); }
    .category-dropdown-title { font-weight: 600; margin-bottom: 10px; color: var(--primary-dark); border-bottom: 1px solid var(--primary-light); padding-bottom: 5px; }
    .category-dropdown ul { list-style: none; max-height: 200px; overflow-y: auto; }
    .category-dropdown li { margin-bottom: 5px; }
    .category-dropdown a { display: flex; align-items: center; gap: 8px; padding: 8px 10px; color: var(--text); text-decoration: none; border-radius: var(--radius-sm); transition: var(--transition); }
    .category-dropdown a:hover { background: var(--primary-light); color: var(--primary-dark); }

    /* WhatsApp Button */
    .whatsapp-cookie-btn { position: fixed; left: 20px; bottom: 80px; width: 60px; height: 60px; background: #25D366; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; box-shadow: var(--shadow-md); cursor: pointer; z-index: 20; transition: var(--transition); border: 2px solid #fff; text-decoration: none; }
    .whatsapp-cookie-btn:hover { transform: translateY(-5px) rotate(15deg); }
    .whatsapp-cookie-btn::before { content: "üéÖ"; position: absolute; font-size: 1.2rem; top: -8px; right: -8px; }

    /* Box Builder */
    .box-builder-btn { position: fixed; right: 20px; bottom: 220px; width: 60px; height: 60px; background: linear-gradient(135deg,#722F37,#d4a574); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; box-shadow: var(--shadow-md); cursor: pointer; z-index: 20; transition: var(--transition); border: 3px solid #fff; animation: box-wiggle 3s infinite; }
    .box-builder-btn:hover { transform: translateY(-5px) scale(1.1); }
    .box-modal { position: fixed; inset: 0; background: rgba(0,0,0,.7); z-index: 1000; display: none; overflow-y: auto; padding: 20px; }
    .box-modal.show { display: block; animation: fade-in .3s; }
    .box-content { background: #fff; margin: 0 auto; padding: 2rem; border-radius: var(--radius-lg); max-width: 900px; width: 100%; animation: slide-up .4s; }
    .box-header { text-align: center; margin-bottom: 2rem; border-bottom: 3px dashed #2d4a3e; padding-bottom: 1.5rem; }
    .box-header h2 { color: var(--primary-dark); font-size: 2.2rem; margin-bottom: .5rem; }
    .box-size-selector { display: grid; grid-template-columns: repeat(auto-fit,minmax(150px,1fr)); gap: 1rem; margin-bottom: 2rem; }
    .size-option { background: var(--primary-light); border: 3px solid transparent; padding: 1.5rem 1rem; border-radius: var(--radius-md); cursor: pointer; transition: var(--transition); text-align: center; position: relative; }
    .size-option:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
    .size-option.selected { border-color: var(--primary); background: #fff; }
    .size-option.selected::after { content: "‚úì"; position: absolute; top: 10px; right: 10px; background: var(--primary); color: #fff; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .size-emoji { font-size: 2.5rem; margin-bottom: .5rem; display: block; }
    .size-name { font-weight: 600; color: var(--primary-dark); font-size: 1.1rem; margin-bottom: .3rem; }
    .size-details { font-size: .85rem; color: var(--text-light); }
    .size-price { font-weight: bold; color: var(--primary); margin-top: .5rem; }
    .box-display-area { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; }
    .visual-box-container { background: linear-gradient(135deg,#faf0f0,#f5e6e6); border: 4px solid #722F37; border-radius: var(--radius-md); padding: 2rem; position: relative; min-height: 300px; box-shadow: inset 0 4px 12px rgba(0,0,0,.1); }
    .box-lid { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: #722F37; color: #fff; padding: 8px 20px; border-radius: 20px; font-weight: 600; font-size: .9rem; }
    .box-grid { display: grid; gap: 10px; height: 100%; }
    .box-grid.small { grid-template-columns: repeat(2,1fr); }
    .box-grid.medium { grid-template-columns: repeat(3,1fr); }
    .box-grid.large { grid-template-columns: repeat(4,1fr); }
    .box-slot { background: rgba(255,255,255,.6); border: 2px dashed #722F37; border-radius: var(--radius-sm); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: .5rem; min-height: 80px; position: relative; transition: var(--transition); }
    .box-slot.filled { background: #fff; border-style: solid; border-color: #d4a574; }
    .box-slot-name { font-size: .7rem; text-align: center; font-weight: 500; color: var(--primary-dark); line-height: 1.2; }
    .box-slot-remove { position: absolute; top: -8px; right: -8px; background: #722F37; color: #fff; border: 2px solid #fff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: .8rem; font-weight: bold; opacity: 0; transition: var(--transition); }
    .box-slot.filled:hover .box-slot-remove { opacity: 1; }
    .box-slot.empty::before { content: "+"; font-size: 2rem; color: #722F37; opacity: .4; }
    .item-selection-area { background: var(--primary-light); border-radius: var(--radius-md); padding: 1.5rem; max-height: 400px; overflow-y: auto; }
    .selection-header { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid #fff; }
    .selection-header h3 { color: var(--primary-dark); font-size: 1.3rem; margin-bottom: .5rem; }
    .category-tabs { display: flex; gap: .5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    .category-tab { background: #fff; border: 2px solid var(--primary); padding: .5rem 1rem; border-radius: 20px; cursor: pointer; font-size: .85rem; font-weight: 500; color: var(--primary-dark); transition: var(--transition); }
    .category-tab:hover, .category-tab.active { background: var(--primary); color: #fff; }
    .selectable-items { display: grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); gap: .8rem; }
    .selectable-item { background: #fff; border: 2px solid transparent; border-radius: var(--radius-sm); padding: 1rem .5rem; cursor: pointer; transition: var(--transition); text-align: center; }
    .selectable-item:hover { border-color: #d4a574; transform: translateY(-3px); }
    .selectable-item.disabled { opacity: .4; cursor: not-allowed; }
    .selectable-item .item-name { font-size: .8rem; font-weight: 500; color: var(--primary-dark); line-height: 1.2; margin-bottom: .3rem; }
    .selectable-item .item-price-tag { font-size: .75rem; color: var(--primary); font-weight: 600; }
    .box-summary { background: var(--primary-light); border-radius: var(--radius-md); padding: 1.5rem; margin-top: 2rem; }
    .summary-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: .8rem; }
    .summary-row.total { border-top: 2px dashed var(--primary); padding-top: 1rem; margin-top: 1rem; font-size: 1.3rem; font-weight: bold; color: var(--primary-dark); }
    .box-actions { display: flex; gap: 1rem; margin-top: 1.5rem; }
    .box-action-btn { flex: 1; padding: 1rem; border: none; border-radius: var(--radius-sm); font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--transition); }
    .add-to-cart-box-btn { background: var(--primary); color: #fff; }
    .add-to-cart-box-btn:hover { background: var(--primary-dark); }
    .add-to-cart-box-btn:disabled { background: var(--text-light); cursor: not-allowed; }
    .cancel-box-btn { background: #fff; color: var(--primary); border: 2px solid var(--primary) !important; }
    .cancel-box-btn:hover { background: var(--primary-light); }

    /* Footer */
    footer { background: linear-gradient(135deg,#3d2a2a,#4a1c22); color: #fff; padding: 3rem 1rem; text-align: center; }
    .footer-logo { font-family: 'Dancing Script', cursive; font-size: 2.5rem; margin-bottom: 1rem; }
    .social-links { display: flex; justify-content: center; gap: 1.5rem; margin: 1.5rem 0; }
    .social-links a { color: #fff; font-size: 1.5rem; transition: var(--transition); }
    .social-links a:hover { color: #d4a574; transform: translateY(-3px); }
    .footer-text { font-size: .9rem; opacity: .8; }

    /* Loading Animation */
    .loader { display: flex; justify-content: center; align-items: center; height: 200px; }
    .loader div { width: 20px; height: 20px; background: var(--primary); border-radius: 50%; margin: 0 5px; animation: bounce-loader .9s infinite alternate; }
    .loader div:nth-child(2) { animation-delay: .3s; background: #c9a227; }
    .loader div:nth-child(3) { animation-delay: .6s; }

    /* Fortune Cookie */
    .fortune-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.4); z-index: 999; display: none; }
    .fortune-overlay.show { display: block; animation: fade-in .3s; }
    .fortune-cookie { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 180px; height: 180px; background: url('https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f960.svg') no-repeat center/contain; z-index: 1001; cursor: pointer; filter: drop-shadow(0 10px 25px rgba(0,0,0,.4)); }
    .fortune-cookie.crack { animation: crack-cookie 1s forwards; }
    .fortune-paper { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 85%; max-width: 350px; background: #fff9e5; border: 2px dashed #722F37; border-radius: 15px; z-index: 1002; opacity: 0; padding: 25px; }
    .fortune-paper.show { opacity: 1; }
    .fortune-text-container { width: 100%; text-align: center; font-family: 'Dancing Script', cursive; color: var(--primary-dark); font-size: 1.4rem; line-height: 1.6; }
    .fortune-icon { font-size: 2rem; margin-bottom: 15px; display: block; text-align: center; }
    .cookie-sparkle { position: fixed; border-radius: 50%; pointer-events: none; z-index: 100; animation: sparkle-fade 1s forwards; }

    /* Animations */
    @keyframes bounce { 0%,20%,50%,80%,100% { transform: translateY(0) translateX(-50%); } 40% { transform: translateY(-20px) translateX(-50%); } 60% { transform: translateY(-10px) translateX(-50%); } }
    @keyframes bounce-loader { to { transform: translateY(-20px); } }
    @keyframes bounce-in { 0% { transform: scale(.3); opacity: 0; } 50% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
    @keyframes cookie-float { 0% { transform: translateY(0) rotate(0); } 100% { transform: translateY(-8px) rotate(5deg) scale(1.05); } }
    @keyframes cookie-poof { 0% { opacity: 1; transform: scale(1) rotate(0) translateY(0); } 50% { opacity: .8; transform: scale(1.3) rotate(180deg) translateY(-20px); } 100% { opacity: 0; transform: scale(0) rotate(720deg) translateY(-80px); } }
    @keyframes cookie-spin { 0%,100% { transform: rotate(0) scale(1); } 25% { transform: rotate(5deg) scale(1.1); } 75% { transform: rotate(-5deg) scale(1.1); } }
    @keyframes sleigh-float { 0%,100% { transform: translateY(0) translateX(0); } 50% { transform: translateY(-15px) translateX(10px); } }
    @keyframes reindeer-run { 0% { transform: translateY(0); } 100% { transform: translateY(-3px); } }
    @keyframes sparkle-dance { 0%,100% { transform: translateY(0) rotate(0) scale(1); opacity: .8; } 50% { transform: translateY(-10px) rotate(180deg) scale(1.2); opacity: 1; } }
    @keyframes sparkle-fade { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(1) translate(var(--tx,50px),var(--ty,-50px)); opacity: 0; } }
    @keyframes crack-cookie { 0% { transform: translate(-50%,-50%) scale(1); } 40% { transform: translate(-50%,-50%) scale(1.1) rotate(5deg); } 100% { transform: translate(-50%,-50%) scale(0); opacity: 0; } }
    @keyframes box-wiggle { 0%,100% { transform: rotate(0); } 25% { transform: rotate(-5deg); } 75% { transform: rotate(5deg); } }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes gentle-float { 0% { transform: rotate(-5deg) translateY(0); } 100% { transform: rotate(-3deg) translateY(-3px); } }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 6px; }
    ::-webkit-scrollbar-track { background: #fdfbf9; }
    ::-webkit-scrollbar-thumb { background: #d4a5a5; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #722F37; }

    /* Responsive */
    @media (min-width: 768px) {
      .featured-slider { padding-bottom: 2rem; }
      .featured-item { min-width: 160px !important; width: 160px !important; }
      .featured-img { height: 140px; }
      .featured-name { font-size: 1rem; }
      .featured-desc { font-size: .8rem; }
      .featured-price { font-size: .9rem; }
      .featured-button { font-size: .7rem; padding: .3rem .6rem; }
      .items-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 25px; }
      .item-card { border: 1px solid #faf0f0; border-radius: var(--radius-md); padding: 1.2rem; display: flex; flex-direction: column; height: 100%; }
      .item-image { width: 100%; height: 140px; border-radius: 15px; margin-bottom: 1rem; }
      .item-content { padding: 0; flex: 1; display: flex; flex-direction: column; }
      .item-footer { margin-top: auto; }
      .badge { top: .5rem; right: .5rem; }
    }
    @media (min-width: 1024px) { .items-grid { grid-template-columns: repeat(3,1fr); } }
    @media (min-width: 1200px) { .items-grid { grid-template-columns: repeat(4,1fr); } }
    @media (max-width: 768px) {
      .hero h1 { font-size: clamp(2.8rem,8vw,4rem); }
      .item-card .item-name { font-size: 1.2rem !important; font-weight: 600 !important; }
      .box-modal { padding: 10px; }
      .box-content { padding: 1rem; max-height: 95vh; }
      .box-header { margin-bottom: 1rem; padding-bottom: 1rem; }
      .box-header h2 { font-size: 1.5rem; }
      .box-size-selector { grid-template-columns: repeat(3,1fr); gap: .5rem; margin-bottom: 1rem; }
      .size-option { padding: .8rem .5rem; }
      .size-emoji { font-size: 1.5rem; margin-bottom: .3rem; }
      .size-name { font-size: .9rem; }
      .size-details { font-size: .75rem; }
      .size-price { font-size: .85rem; margin-top: .3rem; }
      .box-display-area { grid-template-columns: 1fr; gap: 1rem; margin-bottom: 1rem; }
      .visual-box-container { margin-top: 40px; padding: 1rem; min-height: 200px; }
      .box-lid { font-size: .8rem; padding: 5px 15px; top: -35px; }
      .box-grid { gap: 6px; }
      .box-slot { min-height: 60px; padding: .3rem; }
      .box-slot img { width: 30px !important; height: 30px !important; }
      .box-slot-name { font-size: .6rem; }
      .box-slot-remove { width: 20px; height: 20px; font-size: .7rem; top: -6px; right: -6px; }
      .item-selection-area { padding: 1rem; max-height: 250px; }
      .selection-header h3 { font-size: 1.1rem; }
      .category-tabs { gap: .3rem; margin-bottom: .5rem; }
      .category-tab { padding: .4rem .8rem; font-size: .75rem; border-radius: 15px; }
      .selectable-items { grid-template-columns: repeat(auto-fill,minmax(80px,1fr)); gap: .5rem; }
      .selectable-item { padding: .5rem .3rem; }
      .selectable-item img { width: 45px !important; height: 45px !important; margin-bottom: .3rem !important; }
      .selectable-item .item-name { font-size: .7rem; }
      .selectable-item .item-price-tag { font-size: .65rem; }
      .box-summary { padding: 1rem; margin-top: 1rem; }
      .summary-row { font-size: .9rem; margin-bottom: .5rem; }
      .summary-row.total { font-size: 1.1rem; padding-top: .5rem; margin-top: .5rem; }
      .box-actions { gap: .5rem; margin-top: 1rem; }
      .box-action-btn { padding: .8rem; font-size: .9rem; }
      .snowflake { font-size: 0.7rem; }
      .snowflake:nth-child(2), .snowflake:nth-child(6), .snowflake:nth-child(10) { font-size: 0.9rem; }
    }
    @media (max-width: 380px) {
      .box-size-selector { grid-template-columns: 1fr; }
      .selectable-items { grid-template-columns: repeat(3,1fr); }
    }
  </style>
</head>
<body>
  <!-- Snowflakes -->
  <div class="snowflakes" aria-hidden="true">
    <div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÖ</div><div class="snowflake">‚ùÜ</div>
    <div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÖ</div><div class="snowflake">‚ùÜ</div>
    <div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÖ</div><div class="snowflake">‚ùÜ</div><div class="snowflake">‚ùÑ</div>
  </div>

  <!-- Loading Screen -->
  <div class="cookie-loading-screen" id="cookieLoader">
    <div class="loading-text">heavenlynn</div>
    <div class="loading-subtitle">Santa's delivering treats...</div>
    <div class="cookie-jar">
      <div class="jar">
        <div class="jar-lid">üéÖüõ∑</div>
        <div class="jar-body">
          <div class="cookie-in-jar" id="cookie1">üç™</div>
          <div class="cookie-in-jar" id="cookie2">üç™</div>
          <div class="cookie-in-jar" id="cookie3">üç™</div>
          <div class="cookie-in-jar" id="cookie4">üç™</div>
          <div class="cookie-in-jar" id="cookie5">üç™</div>
        </div>
      </div>
      <div class="loading-text-small">Ho ho ho! Almost there...</div>
    </div>
  </div>

  <!-- Hero -->
  <div class="hero">
    <div class="hero-overlay"></div>
    <div class="slideshow-container"></div>
    <div class="hero-content">
      <h1>heavenlynn</h1>
      <p class="hero-tagline">Artisanal Treats Made with Love</p>
    </div>
    <a href="#menu" class="scroll-down"><i class="fas fa-chevron-down"></i></a>
    <div class="slideshow-dots"></div>
  </div>

  <!-- Contact Bar -->
  <div class="contact-bar">
    <div class="contact-info">
      <div class="contact-item"><i class="fas fa-map-marker-alt"></i><span>Tyre, Lebanon</span></div>
      <div class="contact-separator"></div>
      <div class="contact-item"><i class="fas fa-phone"></i><span>81955816</span></div>
      <div class="contact-separator"></div>
      <div class="contact-item">
        <a href="https://www.instagram.com/heavenlynn.lb/" target="_blank"><i class="fab fa-instagram"></i><span>@heavenlynn.lb</span></a>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-wrapper" id="menu">
    <nav class="nav-container" id="categoryNav"><div class="loader"><div></div><div></div><div></div></div></nav>
  </div>

  <!-- Featured Section -->
  <div class="featured-section">
    <div class="featured-header">
      <h2>Holiday Specials</h2>
      <div class="featured-badge">Festive</div>
    </div>
    <div class="featured-slider" id="featuredSlider"></div>
    <div class="slider-controls">
      <button class="slider-btn" id="sliderPrev"><i class="fas fa-chevron-left"></i></button>
      <button class="slider-btn" id="sliderNext"><i class="fas fa-chevron-right"></i></button>
    </div>
  </div>

  <!-- Menu Sections -->
  <main id="menuSections"></main>

  <!-- Floating Buttons -->
  <button class="category-scroll-btn" id="categoryScrollBtn"><i class="fas fa-cookie-bite"></i></button>
  <div class="category-dropdown" id="categoryDropdown">
    <div class="category-dropdown-title">Browse Categories</div>
    <ul id="categoryDropdownList"></ul>
  </div>
  <button class="box-builder-btn" id="boxBuilderBtn">üéÅ</button>
  <button class="cart-btn" id="cartBtn" style="display:none"><i class="fas fa-shopping-cart"></i><div class="cart-count" id="cartCount" style="display:none">0</div></button>
  <a href="https://wa.me/96181955816" class="whatsapp-cookie-btn" target="_blank"><i class="fab fa-whatsapp"></i></a>

  <!-- Box Builder Modal -->
  <div class="box-modal" id="boxModal">
    <div class="box-content">
      <div class="box-header">
        <h2>Build Your Holiday Box</h2>
        <p>Choose a box size and fill it with your favorite treats!</p>
      </div>
      <div class="box-size-selector" id="boxSizeSelector">
        <div class="size-option" data-size="small" data-slots="4"><span class="size-emoji">üì¶</span><div class="size-name">Small Box</div><div class="size-details">4 items</div><div class="size-price">Free Box</div></div>
        <div class="size-option" data-size="medium" data-slots="6"><span class="size-emoji">üì¶üì¶</span><div class="size-name">Medium Box</div><div class="size-details">6 items</div><div class="size-price">Free Box</div></div>
        <div class="size-option" data-size="large" data-slots="8"><span class="size-emoji">üì¶üì¶üì¶</span><div class="size-name">Large Box</div><div class="size-details">8 items</div><div class="size-price">Free Box</div></div>
      </div>
      <div class="box-display-area" id="boxDisplayArea" style="display:none">
        <div class="visual-box-container">
          <div class="box-lid">Your Holiday Box</div>
          <div class="box-grid" id="boxGrid"></div>
        </div>
        <div class="item-selection-area">
          <div class="selection-header">
            <h3>Choose Your Treats</h3>
            <p id="slotsRemaining">Select items to fill your box</p>
          </div>
          <div class="category-tabs" id="categoryTabs"></div>
          <div class="selectable-items" id="selectableItems"></div>
        </div>
      </div>
      <div class="box-summary" id="boxSummary" style="display:none">
        <div class="summary-row"><span>Box Size:</span><span id="summaryBoxSize">-</span></div>
        <div class="summary-row"><span>Items Selected:</span><span id="summaryItemCount">0</span></div>
        <div class="summary-row total"><span>Total:</span><span id="summaryTotal">$0.00</span></div>
        <div class="box-actions">
          <button class="box-action-btn add-to-cart-box-btn" id="addBoxToCart" disabled>Add Box to Cart</button>
          <button class="box-action-btn cancel-box-btn" id="cancelBox">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Modal -->
  <div class="cart-modal" id="cartModal">
    <div class="cart-content">
      <div class="cart-header"><h2>Your Order</h2><button class="cart-close" id="cartClose">&times;</button></div>
      <div id="cartItems"></div>
      <div class="cart-total" id="cartTotal" style="display:none"><div>Total: <span class="cart-total-amount" id="totalAmount">$0.00</span></div></div>
      <button class="order-btn" id="orderBtn" disabled>Order via WhatsApp</button>
    </div>
  </div>

  <!-- Thank You Modal -->
  <div class="thank-you-modal" id="thankYouModal">
    <div class="thank-you-content">
      <div class="thank-you-cookie">‚ùÑ</div>
      <h2>Thank You!</h2>
      <p>Your order has been sent to WhatsApp. Happy Holidays!</p>
    </div>
  </div>

  <!-- Fortune Cookie Elements -->
  <div class="fortune-overlay" id="fortuneOverlay"></div>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-logo">heavenlynn</div>
      <div class="social-links">
        <a href="https://www.instagram.com/heavenlynn.lb/" target="_blank"><i class="fab fa-instagram"></i></a>
      </div>
      <p class="footer-text">¬© 2025 heavenlynn Bakery. All rights reserved.</p>
      <p class="footer-text">Tyre, Lebanon ‚Ä¢ 81955816</p>
    </div>
  </footer>

<script>
// Config
const SUPABASE_URL = 'https://cfvsxnvvkdskbkljqicw.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmdnN4bnZ2a2Rza2JrbGpxaWN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MzU0MTcsImV4cCI6MjA2MDExMTQxN30.dNZsSOJyW1bE4bDQP-AIEYV7Z6hlw_iVMN6LZ2IdPio';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const iconMap = {
  "Cookies": "fa-cookie-bite", "Rolls": "fa-bread-slice", "Slices": "fa-chart-pie", 
  "Cakes": "fa-cake-candles", "Cups": "fa-bowl-food", "Cheesecakes": "fa-cheese",
  "Add-ons": "fa-plus-circle", "Drinks": "fa-coffee", "Ice Cream": "fa-ice-cream", "Cookie Cakes": "fa-cookie"
};

const specialBadges = {
  "Sea Salt Cookie": "Best Seller", "Chocolate Chip Cookie": "Popular", "Cinnamon Roll": "Best Seller",
  "Red Velvet": "Featured", "Cappuccino": "New", "Strawberry Cheesecake": "Chef's Choice"
};

const categoryOrder = ["Cookies", "Rolls", "Slices", "Cakes", "Cookie Cakes", "Cups", "Cheesecakes", "Ice Cream", "Drinks", "Add-ons"];

// FALLBACK DATA (used if database tables are empty)
const fallbackSlideImages = [
  "images/lemon-cheesec.jpg", "images/zesty_fullpic.jpg", "images/cc_dec.jpg", "images/date_cke_again.jpg",
  "images/fruit_cake.jpg", "images/heavenlynn_spec.jpg", "images/heavenly_cup.jpg", "images/birthday.jpg",
  "images/cookies.jpeg", "images/tartes.jpeg", "images/cookie-choc.jpg", "images/cookie-ice.jpg", "images/san.jpeg"
];

const fallbackFeaturedItems = [
  { name: "Lemon Cheesecake", description: "Creamy lemon cheesecake with a zesty lemon curd topping.", price: 30, image: "images/lemon-cheesec.jpg", tag: "Sun-Kissed Slice!" },
  { name: "Zesty Lemon Cheesecake Jar", description: "Tangy, Creamy and full of lemony love", price: 4, image: "images/Lemon-Chee.jpg", tag: "New" },
  { name: "Healthy Chia Pudding", description: "Creamy chia-almond blend, naturally sweet and nutrient-rich.", price: 5, image: "images/healthy_chiapudd.jpg", tag: "Healthy Treat" },
  { name: "The Heavenly Cup", description: "Layers of chocolate, brownies, and strawberries May's best-selling indulgence!", price: 6, image: "images/heavenly_cup.jpg", tag: "May Best Seller" },
  { name: "Salted Caramel Jar", description: "Creamy caramel, rich mousse, and sea salt layered in a decadent jar.", price: 4.5, image: "images/saltedcaramel_cup.jpg", tag: "New" },
  { name: "Heavenlynn Special", description: "Warm brownie, vanilla ice cream, and caramel drizzle pure indulgence.", price: 5, image: "images/heavenlynn_spec.jpg", tag: "Trending" }
];

// DYNAMIC DATA (loaded from database)
let slideImages = [];
let featuredItems = [];

const fortunes = {
  tips: ["Pro Tip: Our cookies taste best when shared with friends!", "Tip: Try our desserts with coffee for perfect pairing.", "Baker's Tip: Store cookies in an airtight container!", "Tip: Visit us before 10am for the freshest pastries!", "Pro Tip: Weekly specials announced every Wednesday on Instagram!"],
  motivation: ["You deserve something sweet today!", "A little indulgence is good for the soul!", "Life is short, eat the cake first!", "The perfect moment for a treat is whenever you decide!", "Your smile makes our day brighter!"],
  inspiration: ["Good things come to those who bake patiently.", "Food made with love feeds the soul.", "Finding joy in the little things is the secret to happiness.", "Creativity and passion are our secret ingredients.", "Best memories are made around good food."],
  offers: ["üåü Show this for 10% off your next order! üåü", "üåü Buy cake slice, get coffee at half price! üåü", "üåü Free cookie with purchase over $20! üåü"]
};

// State
let cart = [];
let currentBox = { size: null, slots: 0, items: [] };
let currentSlide = 0;
let slideInterval;

// ==================== LOAD FROM DATABASE ====================
async function loadSlideshowFromDB() {
  try {
    const { data, error } = await supabase
      .from('slideshow_images')
      .select('*')
      .eq('active', true)
      .order('order_position');
    
    if (error) throw error;
    
    if (data && data.length > 0) {
      slideImages = data.map(s => s.image_url);
      console.log('‚úÖ Loaded', slideImages.length, 'slides from database');
    } else {
      slideImages = fallbackSlideImages;
      console.log('‚ÑπÔ∏è Using fallback slideshow images');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Could not load slides from DB, using fallback:', e.message);
    slideImages = fallbackSlideImages;
  }
}

async function loadFeaturedFromDB() {
  try {
    const { data, error } = await supabase
      .from('weekly_specials')
      .select('*')
      .eq('active', true)
      .order('order_position');
    
    if (error) throw error;
    
    if (data && data.length > 0) {
      featuredItems = data.map(s => ({
        name: s.name,
        description: s.description || '',
        price: parseFloat(s.price),
        image: s.image_url || 'images/placeholder.jpg',
        tag: s.tag || 'Special'
      }));
      console.log('‚úÖ Loaded', featuredItems.length, 'specials from database');
    } else {
      featuredItems = fallbackFeaturedItems;
      console.log('‚ÑπÔ∏è Using fallback featured items');
    }
  } catch (e) {
    console.log('‚ö†Ô∏è Could not load specials from DB, using fallback:', e.message);
    featuredItems = fallbackFeaturedItems;
  }
}

// Cart Functions
function addToCart(item) {
  const existing = cart.find(i => i.name === item.name);
  if (existing) existing.quantity += 1;
  else cart.push({ ...item, quantity: 1 });
  updateCartUI();
  document.getElementById('cartBtn').style.display = 'flex';
  document.getElementById('cartBtn').style.transform = 'scale(1.2)';
  setTimeout(() => document.getElementById('cartBtn').style.transform = 'scale(1)', 200);
}

function removeFromCart(name) {
  cart = cart.filter(i => i.name !== name);
  updateCartUI();
}

function updateQuantity(name, change) {
  const item = cart.find(i => i.name === name);
  if (item) {
    item.quantity += change;
    if (item.quantity <= 0) removeFromCart(name);
    else updateCartUI();
  }
}

function updateCartUI() {
  const count = document.getElementById('cartCount');
  const items = document.getElementById('cartItems');
  const total = document.getElementById('cartTotal');
  const totalAmt = document.getElementById('totalAmount');
  const orderBtn = document.getElementById('orderBtn');
  
  const totalItems = cart.reduce((s, i) => s + i.quantity, 0);
  const totalPrice = cart.reduce((s, i) => s + i.price * i.quantity, 0);
  
  count.style.display = totalItems > 0 ? 'flex' : 'none';
  count.textContent = totalItems;
  
  if (cart.length === 0) {
    items.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
    total.style.display = 'none';
    orderBtn.disabled = true;
  } else {
    items.innerHTML = cart.map(i => `
      <div class="cart-item">
        <div class="cart-item-info"><div class="cart-item-name">${i.name}</div><div class="cart-item-price">$${i.price.toFixed(2)} each</div></div>
        <div class="cart-item-controls">
          <div class="quantity-controls">
            <button class="qty-btn" onclick="updateQuantity('${i.name}',-1)">-</button><span>${i.quantity}</span>
            <button class="qty-btn" onclick="updateQuantity('${i.name}',1)">+</button>
          </div>
          <button class="remove-item" onclick="removeFromCart('${i.name}')">Remove</button>
        </div>
      </div>
    `).join('');
    total.style.display = 'block';
    totalAmt.textContent = `$${totalPrice.toFixed(2)}`;
    orderBtn.disabled = false;
    orderBtn.textContent = `Order via WhatsApp ($${totalPrice.toFixed(2)})`;
  }
}

// Box Builder Functions
function resetBoxBuilder() {
  currentBox = { size: null, slots: 0, items: [] };
  document.querySelectorAll('.size-option').forEach(o => o.classList.remove('selected'));
  document.getElementById('boxDisplayArea').style.display = 'none';
  document.getElementById('boxSummary').style.display = 'none';
}

function setupBoxGrid() {
  const grid = document.getElementById('boxGrid');
  grid.innerHTML = '';
  grid.className = `box-grid ${currentBox.size}`;
  for (let i = 0; i < currentBox.slots; i++) {
    const slot = document.createElement('div');
    slot.className = 'box-slot empty';
    grid.appendChild(slot);
  }
}

async function loadBoxItems() {
  const { data } = await supabase.from('menu_items').select('*').in('category', ['Cookies', 'Rolls', 'Slices', 'Cups', 'Cheesecakes']);
  const filtered = data.filter(i => !i.item_name.toLowerCase().includes('lemon cheesecake') || i.price < 20);
  const grouped = {};
  filtered.forEach(i => { if (!grouped[i.category]) grouped[i.category] = []; grouped[i.category].push(i); });
  
  const tabs = document.getElementById('categoryTabs');
  tabs.innerHTML = '';
  Object.keys(grouped).forEach((cat, idx) => {
    const tab = document.createElement('div');
    tab.className = `category-tab ${idx === 0 ? 'active' : ''}`;
    tab.textContent = cat;
    tab.onclick = () => {
      document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      displayBoxItems(grouped[cat]);
    };
    tabs.appendChild(tab);
  });
  displayBoxItems(grouped[Object.keys(grouped)[0]]);
}

function displayBoxItems(items) {
  const container = document.getElementById('selectableItems');
  container.innerHTML = '';
  const total = currentBox.items.reduce((s, i) => s + i.quantity, 0);
  
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = `selectable-item ${total >= currentBox.slots ? 'disabled' : ''}`;
    div.innerHTML = `
      <img src="${item.image_url || '/api/placeholder/100/100'}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;margin-bottom:.5rem">
      <div class="item-name">${item.item_name}</div>
      <div class="item-price-tag">$${parseFloat(item.price).toFixed(2)}</div>
    `;
    div.onclick = () => !div.classList.contains('disabled') && addItemToBox({ name: item.item_name, price: parseFloat(item.price), image: item.image_url });
    container.appendChild(div);
  });
  updateSlotsRemaining();
}

function addItemToBox(item) {
  const total = currentBox.items.reduce((s, i) => s + i.quantity, 0);
  if (total < currentBox.slots) {
    const existing = currentBox.items.find(i => i.name === item.name);
    if (existing) existing.quantity += 1;
    else currentBox.items.push({ ...item, quantity: 1 });
    updateBoxDisplay();
    document.querySelector('.category-tab.active')?.click();
  }
}

function removeItemFromBox(name) {
  const item = currentBox.items.find(i => i.name === name);
  if (item) {
    item.quantity -= 1;
    if (item.quantity <= 0) currentBox.items = currentBox.items.filter(i => i.name !== name);
  }
  updateBoxDisplay();
  document.querySelector('.category-tab.active')?.click();
}

function updateBoxDisplay() {
  const slots = document.querySelectorAll('.box-slot');
  let idx = 0;
  slots.forEach(s => { s.className = 'box-slot empty'; s.innerHTML = ''; });
  
  currentBox.items.forEach(item => {
    for (let i = 0; i < item.quantity && idx < currentBox.slots; i++, idx++) {
      const slot = slots[idx];
      slot.className = 'box-slot filled';
      slot.innerHTML = `
        <img src="${item.image}" style="width:40px;height:40px;object-fit:cover;border-radius:6px;margin-bottom:.2rem">
        <div class="box-slot-name">${item.name}</div>
        <div class="box-slot-remove">√ó</div>
      `;
      slot.querySelector('.box-slot-remove').onclick = e => { e.stopPropagation(); removeItemFromBox(item.name); };
    }
  });
  updateBoxSummary();
}

function updateSlotsRemaining() {
  const total = currentBox.items.reduce((s, i) => s + i.quantity, 0);
  document.getElementById('slotsRemaining').textContent = total >= currentBox.slots ? '‚úÖ Box is full!' : `${currentBox.slots - total} slot(s) remaining`;
}

function updateBoxSummary() {
  const total = currentBox.items.reduce((s, i) => s + i.quantity, 0);
  const price = currentBox.items.reduce((s, i) => s + i.price * i.quantity, 0);
  document.getElementById('summaryBoxSize').textContent = currentBox.size ? currentBox.size.charAt(0).toUpperCase() + currentBox.size.slice(1) : '-';
  document.getElementById('summaryItemCount').textContent = `${total}/${currentBox.slots}`;
  document.getElementById('summaryTotal').textContent = `$${price.toFixed(2)}`;
  document.getElementById('addBoxToCart').disabled = total !== currentBox.slots;
  updateSlotsRemaining();
}

// Menu Loading
async function loadMenu() {
  const { data, error } = await supabase.from('menu_items').select('*').order('category', { ascending: true });
  if (error) { console.error(error); return; }
  
  document.querySelector('.loader').style.display = 'none';
  
  const grouped = {};
  data.forEach(i => { if (!grouped[i.category]) grouped[i.category] = []; grouped[i.category].push(i); });
  
  ['Rolls', 'Cookies', 'Cheesecakes'].forEach(cat => {
    if (grouped[cat]) {
      const priority = { 'Cinnamon Roll': -1, 'Sea Salt Cookie': -1, 'San Sebastian': 1 };
      grouped[cat].sort((a, b) => (priority[a.item_name] || 0) - (priority[b.item_name] || 0));
    }
  });
  
  const nav = document.getElementById('categoryNav');
  const sections = document.getElementById('menuSections');
  const dropdown = document.getElementById('categoryDropdownList');
  nav.innerHTML = ''; dropdown.innerHTML = '';
  
  const sorted = Object.keys(grouped).sort((a, b) => {
    const ia = categoryOrder.indexOf(a), ib = categoryOrder.indexOf(b);
    return (ia === -1 ? Infinity : ia) - (ib === -1 ? Infinity : ib);
  });
  
  sorted.forEach(category => {
    const catId = category.toLowerCase().replace(/\s+/g, '-');
    const icon = iconMap[category] || 'fa-utensils';
    const needsPreorder = ['Cakes', 'Cookie Cakes'].includes(category);
    
    const link = document.createElement('a');
    link.href = `#${catId}`;
    link.innerHTML = `<i class="fas ${icon}"></i>${category}`;
    nav.appendChild(link);
    
    const li = document.createElement('li');
    li.innerHTML = `<a href="#${catId}"><i class="fas ${icon}"></i>${category}</a>`;
    li.querySelector('a').onclick = () => document.getElementById('categoryDropdown').classList.remove('show');
    dropdown.appendChild(li);
    
    const section = document.createElement('section');
    section.id = catId;
    section.innerHTML = `<div class="section-title"><h2>${category}</h2></div>`;
    
    const grid = document.createElement('div');
    grid.className = 'items-grid';
    
    grouped[category].forEach(item => {
      const card = document.createElement('div');
      card.className = 'item-card';
      
      let descHtml = item.description || 'A delicious treat made with the finest ingredients.';
      if (category === 'Add-ons') descHtml = '';
      else if (category === 'Cookie Cakes') {
        const isMini = item.item_name.toLowerCase().includes('mini');
        descHtml += `<br><span style="font-style:italic;color:var(--primary-dark);display:block;margin-top:.5rem">${isMini ? '' : 'Starting from $22<br>'}Decorations <strong>$2-$5 extra</strong></span>`;
      }
      
      card.innerHTML = `
        <div class="item-image"><img src="${item.image_url || '/api/placeholder/400/400'}" alt="${item.item_name}"></div>
        ${specialBadges[item.item_name] ? `<div class="badge">${specialBadges[item.item_name]}</div>` : ''}
        ${needsPreorder ? '<div class="preorder-tag">Preorder</div>' : ''}
        <div class="item-content">
          <div class="item-name">${item.item_name}</div>
          <div class="item-desc">${descHtml}</div>
          <div class="item-footer">
            <div class="item-price">$${parseFloat(item.price).toFixed(2)}</div>
            <button class="add-to-cart-btn">Add to Cart</button>
          </div>
        </div>
      `;
      
      card.querySelector('.add-to-cart-btn').onclick = () => addToCart({ name: item.item_name, price: parseFloat(item.price), category });
      grid.appendChild(card);
    });
    
    section.appendChild(grid);
    sections.appendChild(section);
  });
  
  const navLinks = document.querySelectorAll('nav a');
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const link = document.querySelector(`nav a[href="#${entry.target.id}"]`);
          navLinks.forEach(l => l.classList.remove('active'));
          if (link) { link.classList.add('active'); link.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); }
        }
      });
    }, { rootMargin: '-100px 0px -90% 0px' });
    document.querySelectorAll('section').forEach(s => observer.observe(s));
  }
  navLinks[0]?.classList.add('active');
  
  const navWrapper = document.querySelector('.nav-wrapper');
  window.addEventListener('scroll', () => navWrapper.classList.toggle('scrolled', window.scrollY > 100));
  
  document.querySelectorAll('a[href^="#"]').forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      const target = document.querySelector(a.getAttribute('href'));
      if (target) window.scrollTo({ top: target.offsetTop - 80, behavior: 'smooth' });
    });
  });
}

// Featured Items - NOW DYNAMIC!
function loadFeaturedItems() {
  const slider = document.getElementById('featuredSlider');
  slider.innerHTML = ''; // Clear any existing items
  
  console.log('Loading featured items:', featuredItems); // Debug
  
  featuredItems.forEach(item => {
    const div = document.createElement('div');
    div.className = 'featured-item';
    
    // Make sure tag exists and has a value
    const tagText = item.tag && item.tag.trim() ? item.tag : 'Special';
    const imageUrl = item.image || 'images/placeholder.jpg';
    
    div.innerHTML = `
      <div class="limited-tag" style="position:absolute;top:10px;right:10px;background:#2d4a3e;color:#fff;padding:4px 12px;border-radius:12px;font-size:0.75rem;font-weight:600;z-index:10;transform:rotate(3deg);box-shadow:0 2px 6px rgba(0,0,0,0.2);">${tagText}</div>
      <div class="featured-img"><img src="${imageUrl}" alt="${item.name}" onerror="this.src='images/placeholder.jpg'"></div>
      <div class="featured-content">
        <div class="featured-name">${item.name}</div>
        <div class="featured-desc">${item.description || ''}</div>
        <div class="featured-footer">
          <div class="featured-price">$${item.price.toFixed(2)}</div>
          <button class="featured-button">Order Now</button>
        </div>
      </div>
    `;
    div.querySelector('.featured-button').onclick = () => addToCart({ name: item.name, price: item.price, category: 'Featured' });
    slider.appendChild(div);
  });
  
  document.getElementById('sliderPrev').onclick = () => slider.scrollBy({ left: -175, behavior: 'smooth' });
  document.getElementById('sliderNext').onclick = () => slider.scrollBy({ left: 175, behavior: 'smooth' });
}

// Slideshow - NOW DYNAMIC!
function initSlideshow() {
  const container = document.querySelector('.slideshow-container');
  const dots = document.querySelector('.slideshow-dots');
  
  container.innerHTML = '';
  dots.innerHTML = '';
  
  slideImages.forEach((img, i) => {
    const slide = document.createElement('div');
    slide.className = `slide ${i === 0 ? 'active' : ''}`;
    slide.style.backgroundImage = `url(${img})`;
    container.appendChild(slide);
    
    const dot = document.createElement('div');
    dot.className = `dot ${i === 0 ? 'active' : ''}`;
    dot.onclick = () => goToSlide(i);
    dots.appendChild(dot);
  });
  
  slideInterval = setInterval(() => goToSlide((currentSlide + 1) % slideImages.length), 5000);
  container.onmouseover = () => clearInterval(slideInterval);
  container.onmouseleave = () => slideInterval = setInterval(() => goToSlide((currentSlide + 1) % slideImages.length), 5000);
}

function goToSlide(n) {
  const slides = document.querySelectorAll('.slide');
  const dots = document.querySelectorAll('.dot');
  if (!slides[n]) return;
  slides[currentSlide]?.classList.remove('active');
  dots[currentSlide]?.classList.remove('active');
  currentSlide = n;
  slides[n]?.classList.add('active');
  dots[n]?.classList.add('active');
}

// Fortune Cookie
function setupFortuneCookie() {
  const btn = document.getElementById('categoryScrollBtn');
  const overlay = document.getElementById('fortuneOverlay');
  let cookie, paper;
  
  btn.onclick = e => {
    e.stopPropagation();
    btn.style.display = 'none';
    overlay.classList.add('show');
    
    cookie = document.createElement('div');
    cookie.className = 'fortune-cookie';
    cookie.style.display = 'block';
    document.body.appendChild(cookie);
    
    cookie.onclick = () => {
      cookie.classList.add('crack');
      createSparkles(window.innerWidth / 2, window.innerHeight / 2);
      
      setTimeout(() => {
        paper = document.createElement('div');
        paper.className = 'fortune-paper';
        paper.style.display = 'block';
        document.body.appendChild(paper);
        
        setTimeout(() => {
          paper.classList.add('show');
          const cats = ['tips', 'motivation', 'inspiration', 'offers'];
          const cat = Math.random() < 0.05 ? 'offers' : cats[Math.floor(Math.random() * 3)];
          const text = fortunes[cat][Math.floor(Math.random() * fortunes[cat].length)];
          const icons = { tips: 'üí°', motivation: '‚ú®', inspiration: 'üåà', offers: 'üéÅ' };
          
          paper.innerHTML = `<div class="fortune-icon">${icons[cat]}</div><div class="fortune-text-container"></div>`;
          const container = paper.querySelector('.fortune-text-container');
          let i = 0;
          const type = () => { if (i < text.length) { container.textContent += text[i++]; setTimeout(type, 40); } else document.addEventListener('click', closeFortune); };
          type();
        }, 200);
      }, 800);
    };
  };
  
  function closeFortune() {
    document.removeEventListener('click', closeFortune);
    paper?.remove();
    cookie?.remove();
    overlay.classList.remove('show');
    btn.style.display = 'flex';
  }
}

function createSparkles(x, y) {
  for (let i = 0; i < 20; i++) {
    const s = document.createElement('div');
    s.className = 'cookie-sparkle';
    s.style.cssText = `left:${x + (Math.random() - .5) * 100}px;top:${y + (Math.random() - .5) * 100}px;background:hsl(${Math.random() * 360},100%,65%);width:${4 + Math.random() * 10}px;height:${4 + Math.random() * 10}px;--tx:${(Math.random() - .5) * 100}px;--ty:${(Math.random() - .5) * 100}px`;
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 1500);
  }
}

// Loading Screen
window.onload = () => {
  const cookies = ['cookie1', 'cookie2', 'cookie3', 'cookie4', 'cookie5'];
  let eaten = 0;
  const eat = () => {
    if (eaten < cookies.length) {
      document.getElementById(cookies[eaten++])?.classList.add('eaten');
      if (eaten < cookies.length) setTimeout(eat, 500);
      else setTimeout(() => {
        const loader = document.getElementById('cookieLoader');
        loader.classList.add('hide');
        setTimeout(() => loader.remove(), 800);
      }, 300);
    }
  };
  setTimeout(eat, 500);
};

// Init - LOAD FROM DATABASE FIRST!
document.addEventListener('DOMContentLoaded', async () => {
  // Load dynamic content from database first
  await Promise.all([
    loadSlideshowFromDB(),
    loadFeaturedFromDB()
  ]);
  
  // Then initialize everything
  loadMenu();
  loadFeaturedItems();
  initSlideshow();
  setupFortuneCookie();
  
  // Cart modal
  document.getElementById('cartBtn').onclick = () => document.getElementById('cartModal').style.display = 'block';
  document.getElementById('cartClose').onclick = () => document.getElementById('cartModal').style.display = 'none';
  document.getElementById('cartModal').onclick = e => { if (e.target.id === 'cartModal') e.target.style.display = 'none'; };
  document.getElementById('orderBtn').onclick = () => {
    if (!cart.length) return;
    const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
    let msg = "Hi! I'd like to place an order from Heavenlynn:\n\n";
    cart.forEach(i => msg += `‚Ä¢ ${i.name} x${i.quantity} - $${(i.price * i.quantity).toFixed(2)}\n`);
    msg += `\nTotal: $${total.toFixed(2)}\n\nThank you!`;
    window.open(`https://wa.me/96181955816?text=${encodeURIComponent(msg)}`, '_blank');
    cart = [];
    updateCartUI();
    document.getElementById('cartModal').style.display = 'none';
    document.getElementById('thankYouModal').style.display = 'flex';
    setTimeout(() => document.getElementById('thankYouModal').style.display = 'none', 4000);
  };
  
  // Box builder
  document.getElementById('boxBuilderBtn').onclick = () => { document.getElementById('boxModal').classList.add('show'); resetBoxBuilder(); };
  document.getElementById('cancelBox').onclick = () => { document.getElementById('boxModal').classList.remove('show'); resetBoxBuilder(); };
  document.getElementById('boxModal').onclick = e => { if (e.target.id === 'boxModal') { e.target.classList.remove('show'); resetBoxBuilder(); } };
  
  document.querySelectorAll('.size-option').forEach(opt => {
    opt.onclick = () => {
      document.querySelectorAll('.size-option').forEach(o => o.classList.remove('selected'));
      opt.classList.add('selected');
      currentBox = { size: opt.dataset.size, slots: parseInt(opt.dataset.slots), items: [] };
      setupBoxGrid();
      loadBoxItems();
      document.getElementById('boxDisplayArea').style.display = 'grid';
      document.getElementById('boxSummary').style.display = 'block';
      updateBoxSummary();
    };
  });
  
  document.getElementById('addBoxToCart').onclick = () => {
    const total = currentBox.items.reduce((s, i) => s + i.quantity, 0);
    if (total === currentBox.slots) {
      const name = `${currentBox.size.charAt(0).toUpperCase() + currentBox.size.slice(1)} Box`;
      const items = currentBox.items.map(i => `${i.quantity}x ${i.name}`).join(', ');
      const price = currentBox.items.reduce((s, i) => s + i.price * i.quantity, 0);
      addToCart({ name: `${name} (${items})`, price, category: 'Gift Box' });
      document.getElementById('boxModal').classList.remove('show');
      resetBoxBuilder();
      alert('üéÅ Your custom box has been added to cart!');
    }
  };
});
</script>
</body>
</html>
